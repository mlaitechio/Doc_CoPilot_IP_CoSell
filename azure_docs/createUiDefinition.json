{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [],
    "steps": [
      {
        "name": "projectConfig",
        "label": "Project Configuration",
        "elements": [
          {
            "name": "info",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "Document CoPilot - Azure-native AI Document Platform.\nThis deployment includes AI Foundry, Computer Vision, Entra ID, Azure Monitor, Blob Storage, SQL Database, Key Vault, and VM."
            }
          },
          {
            "name": "projectName",
            "type": "Microsoft.Common.TextBox",
            "label": "Project Name",
            "defaultValue": "doccopilot",
            "constraints": {
              "required": true,
              "regex": "^[a-z0-9]{3,15}$",
              "validationMessage": "Must be 3-15 lowercase letters and numbers."
            }
          }
        ]
      },
      {
        "name": "aiConfig",
        "label": "AI & Monitoring Configuration",
        "elements": [
          {
            "name": "aiFoundryHubName",
            "type": "Microsoft.Common.TextBox",
            "label": "AI Foundry Hub Name",
            "defaultValue": "[concat(steps('projectConfig').projectName, '-hub')]"
          },
          {
            "name": "aiFoundryName",
            "type": "Microsoft.Common.TextBox",
            "label": "AI Foundry Project Name",
            "defaultValue": "[concat(steps('projectConfig').projectName, '-project')]"
          },
          {
            "name": "computerVisionName",
            "type": "Microsoft.Common.TextBox",
            "label": "Computer Vision Name",
            "defaultValue": "[concat(steps('projectConfig').projectName, '-vision')]"
          }
        ]
      },
      {
        "name": "dataConfig",
        "label": "Data & Storage Configuration",
        "elements": [
          {
            "name": "storageAccountName",
            "type": "Microsoft.Common.TextBox",
            "label": "Storage Account Name",
            "defaultValue": "[concat(steps('projectConfig').projectName, 'storage', take(uniqueString(resourceGroup().id), 6))]"
          },
          {
            "name": "sqlServerName",
            "type": "Microsoft.Common.TextBox",
            "label": "SQL Server Name",
            "defaultValue": "[concat(steps('projectConfig').projectName, '-sql')]"
          },
          {
            "name": "sqlAdminUsername",
            "type": "Microsoft.Common.TextBox",
            "label": "SQL Admin Username",
            "defaultValue": "sqladmin"
          },
          {
            "name": "sqlAdminPassword",
            "type": "Microsoft.Common.PasswordBox",
            "label": { "password": "SQL Admin Password", "confirmPassword": "Confirm Password" },
            "options": { "hideConfirmation": false }
          }
        ]
      },
      {
        "name": "vmConfig",
        "label": "Application VM Configuration",
        "elements": [
          {
            "name": "vmName",
            "type": "Microsoft.Common.TextBox",
            "label": "VM Name",
            "defaultValue": "[concat(steps('projectConfig').projectName, '-vm')]"
          },
          {
            "name": "vmSize",
            "type": "Microsoft.Compute.SizeSelector",
            "label": "VM Size",
            "recommendedSizes": ["Standard_D4s_v3", "Standard_D8s_v3"]
          },
          {
            "name": "adminUsername",
            "type": "Microsoft.Common.TextBox",
            "label": "VM Admin Username",
            "defaultValue": "azureuser"
          },
          {
            "name": "adminPassword",
            "type": "Microsoft.Common.PasswordBox",
            "label": { "password": "VM Admin Password", "confirmPassword": "Confirm Password" }
          }
        ]
      }
    ],
    "outputs": {
      "projectName": "[steps('projectConfig').projectName]",
      "aiFoundryHubName": "[steps('aiConfig').aiFoundryHubName]",
      "aiFoundryName": "[steps('aiConfig').aiFoundryName]",
      "computerVisionName": "[steps('aiConfig').computerVisionName]",
      "storageAccountName": "[steps('dataConfig').storageAccountName]",
      "sqlServerName": "[steps('dataConfig').sqlServerName]",
      "sqlAdminUsername": "[steps('dataConfig').sqlAdminUsername]",
      "sqlAdminPassword": "[steps('dataConfig').sqlAdminPassword]",
      "vmName": "[steps('vmConfig').vmName]",
      "vmSize": "[steps('vmConfig').vmSize]",
      "adminUsername": "[steps('vmConfig').adminUsername]",
      "adminPassword": "[steps('vmConfig').adminPassword]"
    }
  }
}
